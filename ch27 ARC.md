# ARC
### chapter 27 ARC

매번 전달할 때 마다 값을 복사해 전달하는 값 타입과는 달리 참조 타입은 하나의 인스턴스가 참조를 통해 여러 곳에서 접근하기 때문에 언제 메모리에서 해제되는지가 중요한 문제이다. 인스턴스가 적절한 시점에 메모리에서 해제되지 않으면 한정적인 메모리 자원을 낭비하게 되며, 이는 성능저하로 이어진다. 스위프트는 프로그램의 메모리 사용을 관리하며 메모리 관리 기법인 ARC 를 사용한다.

    ARC 와 값타입
    ARC 가 관리해주는 참조 횟수 계산은 참조 타빙니 클래스의 인스턴스에만 적용된다. 구조체나 열거형은 값 타입이므로 참조 횟수 계산과 무관합니다. 즉, 구조체나 열거형은 다른 곳에서 참조하지 않기 때문에 ARC 로 관리할 필요가 없다.
    
-----------------------------------------------------------

### chapter 27.1 ARC 란 ?

ARC 기능은 이름에서 알 수 있듯이 자동으로 메모리를 관리해주는 방식. 더 이상 필요하지 않은 클래스의 인스턴스를 메모리에서 해제하는 방식으로 동작한다. 클래스의 인스턴스를 생성할 때 마다 ARC 는 그 인스턴스에 대한 정보를 저장하기 위한 메모리 공간을 따로 또 할당한다. 그 메모리 공간에는 인스턴스 타입 정보와 함께 그 인스턴스와 관련된 저장 프로퍼티의 값 등을 저장한다. 그 후에 인스턴스가 더 이상 필요 없는 상태가 되면 인스턴스가 차지하던 메모리 공간을 다른 용도로 활용할 수 있도록 ARC 가 메모리에서 인스턴스를 없앤다. 인스턴스가 지속해서 필요한 상황에서 ARC 는 인스턴스가 메모리에서 해제되지 않도록 인스턴스 참조 여부를 계속 추적한다.

----------------------------------------------------------

### chapter 27.2 강한참조

강한 참조 : 인스턴스가 계쏙해서 메모리에 남아있어야 하는 명분을 만들어 주는 것이다. 인스턴스는 참조 횟수가 -이 되는 순간 메모리에서 해제되는데, 인스턴스를 다른 인스턴스의 프로퍼티나 변수, 상수 등에 할당할 때 강한참조를 사용하면 참조 횟수가 1 증가한다. 또 강한참조를 사용하는 프로퍼티, 변수, 상수 등에 nil 을 할당해주면 원래 자신에게 할당되어 있던 인스턴스의 참조 횟수가 1 감소한다. 참조의 기본은 강한참조 이므로 클래스 타입의 프로퍼티, 변수, 상수 등을 선언할 때 별도의 식별자를 명시하지 않으면 강한참조를 한다. 프로퍼티와 변수, 상수를 모두 강한참조로 선언해주었던 것이다. [코드27-1] 참고. 참조 횟수가 0이 되는 순간 인스턴스가 ARC의 규칙에 의해 메모리에서 해제되며 메모리에서 해제되기 직전에 디이니셜라이저를 호출.

--------------------------------------------------------

### chapter 27.3 약한참조

약한 참조 : 강한참조와 달리 자신이 참조하는 인스턴스의 참조 횟수를 증가시키지 않는다. 참조 타입의 프로퍼티나 변수의 선언 앞에 weak 키워드를 써주면 그 프로퍼티나 변수는 자신이 참조하는 인스턴스를 약한참조한다. 

    약한참조와 상수, 옵셔널
    약한참조는 상수에서 쓰일 수 없다. 만약 자신이 참조하던 인스턴스가 메모리에서 해제된다면 nil 이 할당될 수 있어야 하기 때문입니다. 그래서 약한참조를 할 때는 자신의 값을 변경할 수 있는 변수로 선언해야 한다. 더불어 nil 이 할당될 수 있어야 하므로 약한참조는 항상 옵셔널이여야 한다. 즉, 옵셔널 변수만 약한참조를 할 수 있다.
    
-------------------------------------------------------

### chapter 27.4 미소유 참조

참조 횟수를 증가시키지 않고 참조할 수 있는 방법은 약한참조만 있는 것이 아니다. 약한 참조와 마찬가지로 미소유참조는 인스턴스의 참조 횟수를 증가시키지 않는다. 미소유 참조는 약한참조와 다르게 자신이 참조하는 인스턴스가 항상 메모리에 존재할 것이라는 전제를 기반으로 동작한다. 즉, 자신이 참조하는 인스턴스가 메모리에서 해제되더라도 스스로 nil 을 할당해주지 않는다는 뜻이다. 그렇기에 미소유참조를 하는 변수나 프로퍼티는 옵셔널이나 변수가 아니어도 상관없다. 하지만 미소유참조를 하면서 메모리에서 해제된 인스턴스에 접근하려 한다면 잘못된 메모리 접근으로 강제종료 된다. 따라서 미소유참조는 참조하는 동안 해당 인스턴스가 메모리에서 해제되지 않으리라는 확신이 있을 때만 사용한다.

-------------------------------------------------------

### chapter 27.5 미소유 옵셔널 참조

클래스를 참조하는 옵셔널을 미소유로 표시할 수 있다. ARC 소유 모델에 따르면 미소유 옵셔널 참조와 약한참조를 같은 상황에 사용할 수 있다. 차이가 있다면 미소유 옵셔널 참조는 항상 유효한 객체를 가리키거나 그렇지 않으면 nil 을 할당해주도록 직접 신경을 써야 한다는 것이다.

    옵셔널 값의 기본타입은 스위프트 표준 라이브러리에 열거형으로 정의된 Optional 타입이다. 즉, 값 타입인데. 값 타입은 참조 타입이 아니므로 unowned 등으로 참조 관리를 할 수 없다. 그러나 옵셔널은 값 타입일지라도 예외적으로 unowned 등을 활용해 참조 관리를 할 수 있다. 또, 클래스를 감싸는 옵셔널은 참조 횟수 계산을 하지 않기 때문에 강한참조로 관리할 필요가 없다.

--------------------------------------------------------

### chapter 27.7 클로저의 강한참조 순환


